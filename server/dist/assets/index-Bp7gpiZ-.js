import{r as s,o as j,c as L,e as u,b as t,w as l,f as d,t as y,k as N,m as k,l as f,x as D,E as I}from"./index-BZvC1LFB.js";import{a as R,E as $,b as M,c as P}from"./el-select-CLzAlndN.js";import"./el-scrollbar-DxkZQJQI.js";import"./el-popper-CKkpa1WL.js";import"./el-checkbox-Bz7XNQQf.js";import{_ as A,U as q,C as G,a as H,d as J,e as K}from"./common-DA9UduY8.js";import{f as Q}from"./format-8cCTDHEj.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./strings-B2eoNP8o.js";import"./_initCloneObject-Biqzf-Ei.js";import"./isUndefined-DCTLXrZ8.js";import"./el-avatar-B8N8FfxF.js";import"./_baseClone-BeqKcFuR.js";const U=(b,_)=>{fetch(b).then(c=>c.blob()).then(c=>{const p=window.URL.createObjectURL(c),n=document.createElement("a");n.style.display="none",n.href=p,n.download=_,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(p),document.body.removeChild(n)}).catch(()=>alert("文件下载失败"))},X={class:"table-box"},Y={class:"btn-list"},Z=["onClick"],ee={class:"pagination"},ae=Object.assign({name:"Upload"},{__name:"index",setup(b){const _=s("/api"),c=s(""),p=s(""),n=s(1),w=s(0),m=s(10),v=s({}),h=s([]),E=e=>{m.value=e,i()},z=e=>{n.value=e,i()},i=async()=>{const e=await H({page:n.value,pageSize:m.value,...v.value});e.code===0&&(h.value=e.data.list,w.value=e.data.total,n.value=e.data.page,m.value=e.data.pageSize)};i();const B=async e=>{k.confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await J(e)).code===0&&(f({type:"success",message:"删除成功!"}),h.value.length===1&&n.value>1&&n.value--,i())}).catch(()=>{f({type:"info",message:"已取消删除"})})},S=e=>{e.url.indexOf("http://")>-1||e.url.indexOf("https://")>-1?U(e.url,e.name):U(_.value+"/"+e.url,e.name)},T=async e=>{k.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then(async({value:o})=>{e.name=o,(await K(e)).code===0&&(f({type:"success",message:"编辑成功!"}),i())}).catch(()=>{f({type:"info",message:"取消修改"})})};return(e,o)=>{const C=D,g=I,r=R,F=$,O=M,V=P;return j(),L("div",null,[u("div",X,[u("div",Y,[t(A,{imageCommon:p.value,"onUpdate:imageCommon":o[0]||(o[0]=a=>p.value=a),onOnSuccess:i},null,8,["imageCommon"]),t(q,{imageUrl:c.value,"onUpdate:imageUrl":o[1]||(o[1]=a=>c.value=a),"file-size":512,"max-w-h":1080,onOnSuccess:i},null,8,["imageUrl"]),t(C,{modelValue:v.value.keyword,"onUpdate:modelValue":o[2]||(o[2]=a=>v.value.keyword=a),class:"keyword",placeholder:"请输入文件名"},null,8,["modelValue"]),t(g,{type:"primary",icon:"search",onClick:i},{default:l(()=>[d("查询")]),_:1})]),t(O,{data:h.value},{default:l(()=>[t(r,{align:"left",label:"预览",width:"100"},{default:l(a=>[t(G,{"pic-type":"file","pic-src":a.row.url,preview:""},null,8,["pic-src"])]),_:1}),t(r,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:l(a=>[u("div",null,y(N(Q)(a.row.UpdatedAt)),1)]),_:1}),t(r,{align:"left",label:"文件名",prop:"name",width:"180"},{default:l(a=>[u("div",{class:"name",onClick:x=>T(a.row)},[d(y(a.row.name)+" ",1),t(g,{icon:"edit",type:"primary",link:""},{default:l(()=>[d("编辑")]),_:1})],8,Z)]),_:1}),t(r,{align:"left",label:"链接",prop:"url","min-width":"300"}),t(r,{align:"left",label:"标签",prop:"tag",width:"100"},{default:l(a=>[t(F,{type:a.row.tag==="jpg"?"info":"success","disable-transitions":""},{default:l(()=>[d(y(a.row.tag),1)]),_:2},1032,["type"])]),_:1}),t(r,{align:"left",label:"操作",width:"160"},{default:l(a=>[t(g,{icon:"download",type:"primary",link:"",onClick:x=>S(a.row)},{default:l(()=>[d("下载")]),_:2},1032,["onClick"]),t(g,{icon:"delete",type:"primary",link:"",onClick:x=>B(a.row)},{default:l(()=>[d("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),u("div",ee,[t(V,{"current-page":n.value,"page-size":m.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:w.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:z,onSizeChange:E},null,8,["current-page","page-size","total"])])])])}}}),fe=W(ae,[["__scopeId","data-v-0367e85e"]]);export{fe as default};
